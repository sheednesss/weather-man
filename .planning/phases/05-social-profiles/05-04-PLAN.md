---
phase: 05-social-profiles
plan: 04
type: execute
wave: 3
depends_on: ["05-02", "05-03"]
files_modified:
  - web/src/hooks/useProfile.ts
  - web/src/hooks/useFollow.ts
  - web/src/hooks/useComments.ts
  - web/src/hooks/usePredictions.ts
  - web/src/features/social/ProfileCard.tsx
  - web/src/features/social/ProfilePage.tsx
  - web/src/features/social/FollowButton.tsx
  - web/src/features/social/CommentList.tsx
  - web/src/features/social/CommentForm.tsx
  - web/src/features/social/ShareButton.tsx
  - web/src/features/social/FeedPage.tsx
  - web/src/features/markets/MarketDetail.tsx
  - web/src/features/trading/TradeForm.tsx
  - web/src/pages/Profile.tsx
  - web/src/pages/Feed.tsx
  - web/src/App.tsx
  - web/package.json
autonomous: false

must_haves:
  truths:
    - "User can create profile with display name"
    - "User can view other users' profiles"
    - "User can follow other forecasters"
    - "User can see feed of followed forecasters' predictions"
    - "User can comment on markets"
    - "User can write explanation with prediction"
    - "User can share prediction to Twitter/X"
  artifacts:
    - path: "web/src/features/social/ProfilePage.tsx"
      provides: "User profile view with predictions"
      min_lines: 50
    - path: "web/src/features/social/FollowButton.tsx"
      provides: "Follow/unfollow toggle"
      exports: ["FollowButton"]
    - path: "web/src/features/social/CommentList.tsx"
      provides: "Market comments display"
      exports: ["CommentList"]
    - path: "web/src/features/social/ShareButton.tsx"
      provides: "Twitter/X share functionality"
      exports: ["ShareButton"]
    - path: "web/src/pages/Feed.tsx"
      provides: "Followed users' predictions feed"
      min_lines: 30
  key_links:
    - from: "web/src/features/social/ProfilePage.tsx"
      to: "web/src/hooks/useProfile.ts"
      via: "Hook usage"
      pattern: "useProfile"
    - from: "web/src/features/social/FollowButton.tsx"
      to: "web/src/hooks/useFollow.ts"
      via: "Hook usage"
      pattern: "useFollow"
    - from: "web/src/features/markets/MarketDetail.tsx"
      to: "web/src/features/social/CommentList.tsx"
      via: "Component import"
      pattern: "CommentList"
---

<objective>
Build all frontend social feature components: profiles, follows, comments, predictions with explanations, and Twitter/X sharing.

Purpose: Delivers the user-facing social features that make Weather Man a social prediction platform, not just a trading app.

Output: Complete social UI integrated into the application.
</objective>

<execution_context>
@/Users/rasheedelhindi/.claude/get-shit-done/workflows/execute-plan.md
@/Users/rasheedelhindi/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-social-profiles/05-RESEARCH.md
@.planning/phases/05-social-profiles/05-02-SUMMARY.md
@.planning/phases/05-social-profiles/05-03-SUMMARY.md

@web/src/hooks/useAuth.ts
@web/src/lib/api.ts
@web/src/features/markets/MarketDetail.tsx
@web/src/features/trading/TradeForm.tsx
@web/src/App.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create social data hooks</name>
  <files>
    web/src/hooks/useProfile.ts
    web/src/hooks/useFollow.ts
    web/src/hooks/useComments.ts
    web/src/hooks/usePredictions.ts
    web/package.json
  </files>
  <action>
1. Install react-share:
   ```bash
   npm install react-share
   ```

2. Create `src/hooks/useProfile.ts`:
   - `useProfile(address)`: GET /social/profiles/:address, returns profile data
   - `useProfileStats(address)`: GET /social/profiles/:address/stats, returns {followerCount, followingCount}
   - `useUpdateProfile()`: PUT /social/profiles mutation, invalidates profile query on success
   - `useUserPredictions(address)`: GET /social/profiles/:address/predictions

3. Create `src/hooks/useFollow.ts`:
   - `useFollowers(address)`: GET /social/followers/:address
   - `useFollowing(address)`: GET /social/following/:address
   - `useIsFollowing(address)`: GET /social/is-following/:address (only if authenticated)
   - `useFollow()`: POST /social/follow/:address mutation
   - `useUnfollow()`: DELETE /social/follow/:address mutation
   - On follow/unfollow success, invalidate: followers, following, is-following, profile-stats queries

4. Create `src/hooks/useComments.ts`:
   - `useComments(marketId)`: GET /social/markets/:marketId/comments
   - `useAddComment()`: POST /social/markets/:marketId/comments mutation
   - Invalidate comments query on success

5. Create `src/hooks/usePredictions.ts`:
   - `usePredictions(marketId)`: GET /social/markets/:marketId/predictions
   - `useAddPrediction()`: POST /social/markets/:marketId/predictions mutation
   - `useFeed()`: GET /social/feed (requires auth)
   - Invalidate predictions/feed queries on success

All hooks should use the `api` helper from lib/api.ts for consistent credential handling.
  </action>
  <verify>
    - `npm run build` succeeds
    - Each hook file exports expected functions
  </verify>
  <done>
    All social data hooks created for profiles, follows, comments, and predictions.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create social UI components</name>
  <files>
    web/src/features/social/ProfileCard.tsx
    web/src/features/social/ProfilePage.tsx
    web/src/features/social/FollowButton.tsx
    web/src/features/social/CommentList.tsx
    web/src/features/social/CommentForm.tsx
    web/src/features/social/ShareButton.tsx
    web/src/features/social/FeedPage.tsx
  </files>
  <action>
1. Create `src/features/social/ProfileCard.tsx`:
   - Props: address, displayName (optional), showFollowButton (optional)
   - Shows truncated address (0x1234...5678) and displayName if set
   - Links to /profile/:address
   - Optionally includes FollowButton

2. Create `src/features/social/FollowButton.tsx`:
   - Props: address (the user to follow)
   - Uses useAuth to check if authenticated
   - Uses useIsFollowing to check current state
   - Shows "Follow" or "Following" button
   - Clicking toggles follow/unfollow
   - Disabled if not authenticated or if viewing own profile
   - Loading state during mutation

3. Create `src/features/social/CommentList.tsx`:
   - Props: marketId
   - Uses useComments hook
   - Renders list of comments with author (ProfileCard compact), content, timestamp
   - Shows "No comments yet" if empty

4. Create `src/features/social/CommentForm.tsx`:
   - Props: marketId
   - Uses useAuth, useAddComment
   - Textarea for comment content (max 1000 chars)
   - Submit button (disabled if not authenticated)
   - Shows "Sign in to comment" if not authenticated
   - Clears form on success

5. Create `src/features/social/ShareButton.tsx`:
   - Props: marketQuestion, prediction ('YES' | 'NO'), explanation (optional), marketUrl
   - Uses react-share's TwitterShareButton or simple URL intent
   - Compose tweet text: "My prediction: {prediction} on "{question}" {explanation if present}"
   - Include hashtags: #WeatherMan #PredictionMarkets
   - Style as icon button with X/Twitter icon

6. Create `src/features/social/ProfilePage.tsx`:
   - Uses route param for address
   - Uses useProfile, useProfileStats, useUserPredictions
   - Editable profile form if viewing own profile (useAuth.address matches)
   - Display name, bio, follower/following counts
   - FollowButton if viewing other user
   - List of user's predictions with market links

7. Create `src/features/social/FeedPage.tsx`:
   - Uses useFeed hook
   - Requires authentication (show "Sign in to see your feed" if not)
   - Renders prediction cards with author, market link, explanation, timestamp
   - Shows "Follow some forecasters to see their predictions" if empty
  </action>
  <verify>
    - All component files exist and export default components
    - `npm run build` succeeds without TypeScript errors
  </verify>
  <done>
    All social UI components created: ProfileCard, ProfilePage, FollowButton, CommentList, CommentForm, ShareButton, FeedPage.
  </done>
</task>

<task type="auto">
  <name>Task 3: Integrate social features into existing pages and routing</name>
  <files>
    web/src/features/markets/MarketDetail.tsx
    web/src/features/trading/TradeForm.tsx
    web/src/pages/Profile.tsx
    web/src/pages/Feed.tsx
    web/src/App.tsx
    web/src/components/layout/Header.tsx
  </files>
  <action>
1. Create `src/pages/Profile.tsx`:
   - Wrapper page that renders ProfilePage component
   - Uses useParams to get address from route

2. Create `src/pages/Feed.tsx`:
   - Wrapper page that renders FeedPage component

3. Update `src/App.tsx` routes:
   - Add route: `/profile/:address` -> Profile page
   - Add route: `/feed` -> Feed page

4. Update `src/components/layout/Header.tsx`:
   - Add "Feed" link in navigation (only visible if authenticated)
   - Add link to own profile (only visible if authenticated)

5. Update `src/features/markets/MarketDetail.tsx`:
   - Add CommentList component below market info
   - Add CommentForm component for adding comments

6. Update `src/features/trading/TradeForm.tsx`:
   - Add optional textarea for prediction explanation (PREDICT-01)
   - Label: "Share your reasoning (optional)"
   - When trade is submitted AND explanation provided, also call useAddPrediction
   - Add ShareButton that appears after successful trade
   - ShareButton should link to current market URL
  </action>
  <verify>
    - `npm run build` succeeds
    - Routes /profile/:address and /feed are accessible
    - MarketDetail shows comments section
    - TradeForm has explanation field and share button after trade
  </verify>
  <done>
    Social features fully integrated into existing application. Routes, navigation, and component integration complete.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete social features: profiles, follows, comments, predictions with explanations, Twitter sharing</what-built>
  <how-to-verify>
1. Start both servers:
   ```bash
   # Terminal 1: cd indexer-api && pnpm dev
   # Terminal 2: cd web && npm run dev
   ```

2. Open http://localhost:5173

3. Test profile creation:
   - Connect wallet
   - Sign in (SIWE signature)
   - Navigate to your profile (header link or /profile/{your-address})
   - Edit display name and bio
   - Save - verify changes persist after refresh

4. Test following:
   - Navigate to another address's profile (you can make up an address like /profile/0x1234567890123456789012345678901234567890)
   - Click Follow button
   - Verify follower count updates
   - Click again to unfollow

5. Test comments:
   - Navigate to a market detail page
   - See comments section (empty or with comments)
   - Add a comment
   - Verify it appears in the list

6. Test prediction with explanation:
   - On market detail, enter a trade
   - Add an explanation in the textarea
   - Submit trade
   - Verify ShareButton appears
   - Click share button - should open Twitter intent

7. Test feed:
   - Follow at least one user
   - Navigate to /feed
   - See that user's predictions (if any)
  </how-to-verify>
  <resume-signal>Type "approved" or describe any issues found</resume-signal>
</task>

</tasks>

<verification>
1. Build verification:
   ```bash
   cd web && npm run build
   # Should complete without errors
   ```

2. Route verification:
   - /profile/:address loads ProfilePage
   - /feed loads FeedPage
   - Header shows Feed link when authenticated

3. Integration verification:
   - MarketDetail includes CommentList and CommentForm
   - TradeForm includes explanation textarea and ShareButton
</verification>

<success_criteria>
- User can create/edit profile with display name and bio (PROFILE-01)
- User can view any user's profile by address (PROFILE-02)
- User can follow/unfollow other users (SOCIAL-01)
- User can see feed of followed users' predictions (SOCIAL-02)
- User can comment on markets (SOCIAL-03)
- User can share prediction to Twitter/X (SOCIAL-04)
- User can write explanation with prediction (PREDICT-01)
- All routes accessible and properly integrated
- Human verification confirms full social flow works
</success_criteria>

<output>
After completion, create `.planning/phases/05-social-profiles/05-04-SUMMARY.md`
</output>
